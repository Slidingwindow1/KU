word pattern 2

aabab
catcatgocatgo

public static bool patternMatches(String value, String pattern) {
char mainChar = pattern[0];
char subChar=mainChar=='a'?'b':'a';
int mainCount = mainChar == 'a' ?
count(pattern, 'a') : 
count(pattern, 'b');
int subCount =
pattern.Length - mainCount;
  
int maxMainSize = 
mainCount == 0 ? 0 : 
value.Length / mainCount;
int firstSubIndex = pattern.IndexOf(subChar);  
for (int mainSize = 0; mainSize <= maxMainSize; i++) {
    
    int subSize = (value.Length- mainCount * mainSize) / subCount;
    if (subSize * subCount + mainSize * mainCount != value.Length) {
      
      continue;
    }
    
    String main = value.SubString(0, mainSize);
      String sub = value.SubString(mainSize * firstSubIndex, mainSize * firstSubIndex + subSize);
  
    String expected = build(pattern, main, mainCount, sub, subCount);
    if (value.Equals(expected)) {
      return true;
    }
  }
  return false;
}

public static String build(String pattern, String main, String sub) {
  StringBuilder sb = new StringBuilder();
  char mainChar = pattern[0];
  for (int i = 0; i < pattern.Length; i++) {
    char curr = pattern[i];
    if (curr == mainChar) {
      sb.Append(main);
    } else {
      sb.Append(sub);
    }
  }
  return sb.ToString();
}
